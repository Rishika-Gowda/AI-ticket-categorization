<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In — SmartDesk</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/css/main.css">
</head>
<body class="auth-body">

<div class="auth-bg">
  <div class="grid-overlay"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
</div>

<div class="auth-page">
  <div class="auth-left">
    <a href="/" class="nav-logo auth-logo-top">
      <svg width="32" height="32" viewBox="0 0 28 28" fill="none">
        <rect width="12" height="12" rx="3" fill="#00D4FF"/>
        <rect x="16" width="12" height="12" rx="3" fill="#0056FF" opacity="0.7"/>
        <rect y="16" width="12" height="12" rx="3" fill="#0056FF" opacity="0.7"/>
        <rect x="16" y="16" width="12" height="12" rx="3" fill="#00D4FF" opacity="0.5"/>
      </svg>
      <span>Smart<strong>Desk</strong></span>
    </a>
    <div class="auth-left-content">
      <h1>Welcome back</h1>
      <p>Sign in to your account to submit and track IT support tickets.</p>
      <div class="auth-features">
        <div class="af-item"><span class="af-dot"></span>AI-powered ticket classification</div>
        <div class="af-item"><span class="af-dot"></span>Real-time priority detection</div>
        <div class="af-item"><span class="af-dot"></span>Full ticket history & analytics</div>
      </div>
    </div>
  </div>

  <div class="auth-right">
    <div class="auth-card">
      <h2>Sign In</h2>
      <p class="auth-sub">Don't have an account? <a href="/signup">Create one →</a></p>

      <div class="error-msg hidden" id="errorMsg"></div>

      <form id="loginForm" autocomplete="off">
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="email" placeholder="you@company.com" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <div class="input-password-wrap">
            <input type="password" id="password" placeholder="••••••••" required>
            <button type="button" class="toggle-pw" onclick="togglePw()">
              <svg id="eye-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>
        <button type="submit" class="btn-submit" id="loginBtn">
          <span class="btn-text">Sign In</span>
          <span class="btn-loader hidden">Signing in...</span>
        </button>
      </form>

      <div class="auth-demo">
        <div class="demo-label">Quick Demo</div>
        <button class="btn-demo" onclick="fillDemo()">Use demo credentials</button>
      </div>
    </div>
  </div>
</div>

<script src="/static/js/auth.js"></script>
<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = document.getElementById('loginBtn');
  const errMsg = document.getElementById('errorMsg');
  errMsg.classList.add('hidden');
  setLoading(btn, true);

  try {
    const res = await fetch('/api/login', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        email: document.getElementById('email').value,
        password: document.getElementById('password').value
      })
    });
    const data = await res.json();
    if (res.ok) {
      // Redirect based on role
      if (data.user.role === 'admin') {
        window.location.href = '/dashboard';
      } else {
        window.location.href = '/my-tickets';
      }
    } else {
      errMsg.textContent = data.error;
      errMsg.classList.remove('hidden');
    }
  } catch (err) {
    errMsg.textContent = 'Connection error. Please try again.';
    errMsg.classList.remove('hidden');
  } finally {
    setLoading(btn, false);
  }
});

function fillDemo() {
  document.getElementById('email').value = 'demo@nexusit.com';
  document.getElementById('password').value = 'demo123';
}
</script>
</body>
</html>
