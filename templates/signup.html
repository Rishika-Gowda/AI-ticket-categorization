<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account — SmartDesk</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/static/css/main.css">
</head>
<body class="auth-body">

<div class="auth-bg">
  <div class="grid-overlay"></div>
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
</div>

<div class="auth-page">
  <div class="auth-left">
    <a href="/" class="nav-logo auth-logo-top">
      <svg width="32" height="32" viewBox="0 0 28 28" fill="none">
        <rect width="12" height="12" rx="3" fill="#00D4FF"/>
        <rect x="16" width="12" height="12" rx="3" fill="#0056FF" opacity="0.7"/>
        <rect y="16" width="12" height="12" rx="3" fill="#0056FF" opacity="0.7"/>
        <rect x="16" y="16" width="12" height="12" rx="3" fill="#00D4FF" opacity="0.5"/>
      </svg>
      <span>Smart<strong>Desk</strong></span>
    </a>
    <div class="auth-left-content">
      <h1>Join SmartDesk</h1>
      <p>Create your account to submit and track IT support tickets.</p>
      <div class="auth-features">
        <div class="af-item"><span class="af-dot"></span>Submit IT support tickets</div>
        <div class="af-item"><span class="af-dot"></span>Track ticket status in real-time</div>
        <div class="af-item"><span class="af-dot"></span>Receive admin updates and resolutions</div>
      </div>
    </div>
  </div>

  <div class="auth-right">
    <div class="auth-card">
      <h2>Create Account</h2>
      <p class="auth-sub">Already have an account? <a href="/login">Sign in →</a></p>

      <div class="error-msg hidden" id="errorMsg"></div>
      <div class="success-msg hidden" id="successMsg"></div>

      <input type="hidden" id="userRole" value="user">
      
      <form id="signupForm" autocomplete="off">
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" id="name" placeholder="Jane Smith" required>
        </div>
        <div class="form-group">
          <label>Email Address</label>
          <input type="email" id="email" placeholder="you@company.com" required>
        </div>
        <div class="form-group">
          <label>Password</label>
          <div class="input-password-wrap">
            <input type="password" id="password" placeholder="Min. 6 characters" required>
            <button type="button" class="toggle-pw" onclick="togglePw()">
              <svg id="eye-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
        </div>
        <div class="password-strength" id="pwStrength">
          <div class="ps-bars">
            <div class="ps-bar" id="ps1"></div>
            <div class="ps-bar" id="ps2"></div>
            <div class="ps-bar" id="ps3"></div>
            <div class="ps-bar" id="ps4"></div>
          </div>
          <span id="ps-label">Enter a password</span>
        </div>
        <button type="submit" class="btn-submit" id="signupBtn">
          <span class="btn-text">Create Account</span>
          <span class="btn-loader hidden">Creating account...</span>
        </button>
      </form>
    </div>
  </div>
</div>

<script src="/static/js/auth.js"></script>
<script>
const pwInput = document.getElementById('password');
pwInput.addEventListener('input', updateStrength);

function updateStrength() {
  const pw = pwInput.value;
  let score = 0;
  if (pw.length >= 6) score++;
  if (pw.length >= 10) score++;
  if (/[A-Z]/.test(pw) && /[0-9]/.test(pw)) score++;
  if (/[^A-Za-z0-9]/.test(pw)) score++;

  const bars = ['ps1','ps2','ps3','ps4'];
  const colors = ['#ef4444','#f97316','#eab308','#22c55e'];
  const labels = ['Too weak','Weak','Good','Strong'];
  bars.forEach((id, i) => {
    const el = document.getElementById(id);
    el.style.background = i < score ? colors[score-1] : 'rgba(255,255,255,0.1)';
  });
  document.getElementById('ps-label').textContent = pw.length > 0 ? labels[score > 0 ? score-1 : 0] : 'Enter a password';
}

document.getElementById('signupForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const btn = document.getElementById('signupBtn');
  const errMsg = document.getElementById('errorMsg');
  const sucMsg = document.getElementById('successMsg');
  const role = document.getElementById('userRole').value;
  
  errMsg.classList.add('hidden');
  sucMsg.classList.add('hidden');
  setLoading(btn, true);

  try {
    const res = await fetch('/api/signup', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        role: role
      })
    });
    const data = await res.json();
    if (res.ok) {
      sucMsg.textContent = 'Account created! Redirecting to login...';
      sucMsg.classList.remove('hidden');
      setTimeout(() => window.location.href = '/login', 1500);
    } else {
      errMsg.textContent = data.error;
      errMsg.classList.remove('hidden');
    }
  } catch (err) {
    errMsg.textContent = 'Connection error. Please try again.';
    errMsg.classList.remove('hidden');
  } finally {
    setLoading(btn, false);
  }
});
</script>
</body>
</html>
